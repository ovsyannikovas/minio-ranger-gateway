# Архитектура MinIO-Ranger Gateway

## Обзор

MinIO-Ranger Gateway - это прокси-сервис, который стоит между клиентами и MinIO, проверяя каждую операцию через Apache Ranger для авторизации.

## Проблема

MinIO не имеет нативной интеграции с Apache Ranger. Для использования централизованного управления политиками безопасности через Ranger необходимо создать промежуточный слой (gateway).

## Решение

### Компоненты системы

1. **Apache Ranger** - система управления политиками безопасности
2. **MinIO** - объектное хранилище (S3-совместимое)
3. **MinIO-Ranger Gateway** - прокси-сервис на FastAPI

### Архитектура

```
Client → Gateway (FastAPI) → MinIO
           ↓
      Apache Ranger (проверка политик)
```

## Поток запроса

1. Клиент отправляет S3-запрос в Gateway
2. Gateway извлекает:
   - Пользователя (из аутентификации)
   - Bucket (из URL)
   - Object (из URL)
   - Операцию (GET/PUT/DELETE/LIST)
3. Gateway проверяет политики в Ranger через REST API
4. Если доступ разрешен → Gateway проксирует запрос в MinIO
5. Если доступ запрещен → Gateway возвращает 403 Forbidden

## Кэширование политик

Для оптимизации производительности политики кэшируются:
- TTL кэша: 5-10 минут (настраивается)
- Инвалидация при изменении политик в Ranger
- Локальное кэширование в памяти (Redis опционально)

## Custom Service в Ranger

### Service Definition

Определяет структуру ресурсов и операций:
- Ресурсы: `bucket`, `object`
- Операции: `read`, `write`, `delete`, `list`

### Service Instance

Создается экземпляр сервиса с конфигурацией:
- Endpoint MinIO
- Другие параметры

### Policies

Политики определяют доступ:
- Кто (пользователь/группа)
- К чему (bucket/object)
- Что может делать (read/write/delete/list)

## Технологии

- **FastAPI** - веб-фреймворк для gateway
- **httpx** - асинхронный HTTP клиент для проксирования
- **cachetools** - кэширование политик
- **boto3** - для работы с S3 API (опционально)

